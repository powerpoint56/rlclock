"use strict";Date.now||(Date.now=function(){return(new Date).getTime()}),function(a,b){function c(a){return a[a.length-1]}function d(a,c){"granted"===b.Notification.permission&&n.data.g&&(m&&setTimeout(m.close.bind(m),5e3),m=new b.Notification(c,{title:a}))}function e(){if(!b.Notification)return alert("Notifications not supported.");"granted"!==b.Notification.permission&&b.Notification.requestPermission()}var f,g,h=2,i=new Date,j=i.getDay(),k={id:function(b){return this.elements[b]||(this.elements[b]=a.getElementById(b))},elements:{}},l={h:function(a){if(this.i=!!a.periods,!this.i)return this.j();this.k(a),this.l(),this.m()},k:function(a){this.periods=a.periods,this.hallLength=a.hallLength,"Hall"===this.periods[1].name&&(this.hallLength=this.o(this.periods[1].end)-this.o(this.periods[1].start)),this.p=1,this.hallLength&&"Hall"===this.periods[1].name&&this.p++,this.q=this.periods[this.p].block,this.s=this.q,this.hallLength&&(this.s+="-"+this.hallLength),this.lunchPeriod=a.lunchPeriod||(this.hallLength>=45?3:4),b.localStorage.setItem("next-day",this.t())},error:function(){h++,k.id("periods-list").textContent="Sorry, there has been an error. Please try reloading soon.",k.id("periods-list").style.display="block"},j:function(){var a;a=6===j||0===j?"Weekend":"No School",k.id("current-title").textContent=a,k.id("current-description").textContent=this.u()},l:function(){for(var b=a.createDocumentFragment(),c=this.periods.length,d=0,e=0;e<c;e++){var f=this.periods[e];f.v=this.o(f.start),f.A=this.o(f.end),f.period===this.lunchPeriod&&"Hall"!==f.name&&(f.B=d++);var g=a.createElement("div");g.className="list-item";var h=a.createElement("span");h.className="list-item-letter",h.textContent=this.C(f),g.appendChild(h);var i=a.createElement("span");i.className="list-item-time",i.textContent=this.D(f.v)+"-"+this.D(f.A),g.appendChild(i),b.appendChild(g)}this.F=b,k.id("periods-list-heading").textContent=this.s,k.id("periods-list-blocks").appendChild(this.F),k.id("periods-list").style.display="block",k.id("about").style.display="block",this.G=k.id("periods-list-blocks").childNodes},m:function(){--h||(this.start=this.periods[0].v,this.end=c(this.periods).A,this.update(!0))},C:function(a){return a.period===this.lunchPeriod&&"Hall"!==a.name?a.block+" - "+this.H[a.B]:a.block||a.name},I:function(){return 6===c(this.periods).period},J:function(a){return this.C(this.periods[this.K+a])},L:function(){if(void 0===this.K)for(var a=0;a<this.periods.length;a++){var b=this.periods[a];if(g>=b.v&&g<b.A+5){this.K=a;break}}else this.G[this.K].classList.remove("period-highlight"),this.K++;this.M=this.periods[this.K].A-g,this.G[this.K].classList.add("period-highlight")},update:function(c){var e,h,l,m;i.setTime(Date.now()),f=i.getDay(),f!==j&&b.location.reload(),c?g=this.o(i.getHours(),i.getMinutes()):g++,g>=this.end?(a.title="RL Schedule",h="After school",l=this.u(),this.K&&this.G[this.K].classList.remove("period-highlight"),m=!0):g<this.start?(h="Before school",e=this.N(this.start-g),l=this.O(e.P,"hour"," ","")+this.O(e.R,"minute"," ")+"until homeroom."):(-4===this.M||void 0===this.M?(this.L(c),h=this.J(0)):this.M--,this.M<=0?(l="Passing time: "+this.O(this.M+5,"minute")+" until "+this.J(1),0===this.M&&(a.title="RL Schedule",d("RL Schedule",this.J(1)+" starts in 5 minutes."))):(l=this.O(this.M,"minute")+" left",a.title="("+this.M+") RL Schedule"),5===this.M&&d("RL Schedule","5 minutes left in "+this.J(0))),h&&(k.id("current-title").textContent=h),l&&(k.id("current-description").textContent=l),m||setTimeout(this.update.bind(this),6e4-1e3*i.getSeconds())},t:function(){if(this.q){var a="HGFEDCBA";return a[(a.indexOf(this.q)+1+this.I())%8]}return b.localStorage.getItem("next-day")||0},u:function(){var a=this.t();return a?(f>0&&f<5?"Tomorrow":"The next school day")+" starts with "+a+" block.":""},o:function(a,b){if("string"==typeof a){var c=a.split(":");return 60*c[0]+1*c[1]}if("number"==typeof a)return 60*a+1*b},N:function(a){return{P:Math.floor(a/60),R:a%60}},D:function(a){var b=this.N(a);return b.R<10&&(b.R="0"+b.R),(b.P%12||12)+":"+b.R},O:function(a,b,c,d){return 0===a?d||"":1===a?a+" "+b+(c||""):a+" "+b+"s"+(c||"")},H:["First Lunch","In Between Lunches","Second Lunch"]};!function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.addEventListener("load",b),d.addEventListener("error",c),d.send()}("rlclock.tk"===b.location.hostname?"//casper.roxburylatin.org/todays_schedule.json":"todays_schedule.json",function(){l.h(JSON.parse(this.responseText))},l.error),addEventListener("DOMContentLoaded",function a(){removeEventListener("DOMContentLoaded",a),l.m(),n.load(),k.id("settings-button").addEventListener("click",n.toggle.bind(n))});var m,n={data:{g:!1},load:function(){this.data=JSON.parse(b.localStorage.getItem("settings"))||this.data},S:function(){var a;this.T=k.id("settings").getElementsByTagName("input");for(var b=0;b<this.T.length;b++)a=this.T[b],a.checked=this.data[a.getAttribute("data-rep")];k.id("settings-submit").addEventListener("click",this.submit.bind(this)),this.U=!0},save:function(){for(var a,c=0;c<this.T.length;c++)a=this.T[c],this.data[a.getAttribute("data-rep")]=a.checked;b.localStorage.setItem("settings",JSON.stringify(this.data)),this.data.g&&e()},submit:function(){this.save(),this.toggle()},toggle:function(){this.U||this.S(),k.id("settings").classList.toggle("appear")}}}(document,window);