"use strict";Date.now||(Date.now=function(){return(new Date).getTime()}),function(a,b){function c(a){return a[a.length-1]}function d(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.addEventListener("load",b),d.addEventListener("error",c),d.send()}function e(a,c){"granted"===b.Notification.permission&&o.data.g&&(n&&setTimeout(n.close.bind(n),5e3),n=new b.Notification(c,{title:a}))}function f(){if(!b.Notification)return alert("Notifications not supported.");"granted"!==b.Notification.permission&&b.Notification.requestPermission()}var g,h,i=2,j=new Date,k=j.getDay(),l={id:function(b){return this.elements[b]||(this.elements[b]=a.getElementById(b))},elements:{}},m={h:function(a){if(this.i=!!a.periods,!this.i)return this.j();this.k(a),this.l(),this.m()},k:function(a){this.periods=a.periods,this.hallLength=a.hallLength,"Hall"===this.periods[1].name&&(this.hallLength=this.o(this.periods[1].end)-this.o(this.periods[1].start)),this.p=1,this.hallLength&&"Hall"===this.periods[1].name&&this.p++,this.q=this.periods[this.p].block,this.s=this.q,this.hallLength&&(this.s+="-"+this.hallLength),this.lunchPeriod=a.lunchPeriod||(this.hallLength>=45?3:4),b.localStorage.setItem("next-day",this.t())},error:function(){i++,l.id("periods-list").textContent="Sorry, there has been an error. Please try reloading soon.",l.id("periods-list").classList.remove("hide")},j:function(){var a;a=6===k||0===k?"Weekend":"No School",l.id("current-title").textContent=a,l.id("current-description").textContent=this.u()},v:function(){d("/exam_schedule.json",function(){m.A(JSON.parse(this.responseText))},m.error)},A:function(b){a.createDocumentFragment();l.id("periods-list").classList.add("hide");for(var c in b.B){var d=a.createElement("div");d.className="list-section";var e=a.createElement("h3");e.textContent=c,d.appendChild(e);for(var f=a.createElement("div"),g=0;g<b.B[c].length;++g)f.appendChild(this.C(b.B[c][g][0],b.B[c][g][1]));d.appendChild(f),l.id("schedule").appendChild(d)}},l:function(){for(var b=a.createDocumentFragment(),c=this.periods.length,d=0,e=0;e<c;e++){var f=this.periods[e];f.D=this.o(f.start),f.F=this.o(f.end),f.period===this.lunchPeriod&&"Hall"!==f.name&&(f.G=d++),b.appendChild(this.C(this.H(f),this.I(f.D)+"-"+this.I(f.F)))}this.J(b,this.s)},C:function(b,c){var d=a.createElement("div");d.className="list-item";var e=a.createElement("span");e.className="list-item-letter",e.textContent=b,d.appendChild(e);var f=a.createElement("span");return f.className="list-item-time",f.textContent=c,d.appendChild(f),d},J:function(a,b){this.K=a,l.id("periods-list-heading").textContent=b,l.id("periods-list-blocks").appendChild(this.K),l.id("periods-list").classList.remove("hide"),this.L=l.id("periods-list-blocks").childNodes},m:function(){--i||(this.start=this.periods[0].D,this.end=c(this.periods).F,this.update(!0))},H:function(a){return a.period===this.lunchPeriod&&"Hall"!==a.name?a.block+" - "+this.M[a.G]:a.block||a.name},N:function(){return 6===c(this.periods).period},O:function(a){return this.H(this.periods[this.P+a])},R:function(){if(void 0===this.P)for(var a=0;a<this.periods.length;a++){var b=this.periods[a];if(h>=b.D&&h<b.F+5){this.P=a;break}}else this.L[this.P].classList.remove("period-highlight"),this.P++;this.S=this.periods[this.P].F-h,this.L[this.P].classList.add("period-highlight")},update:function(c){var d,f,i,m;j.setTime(Date.now()),g=j.getDay(),g!==k&&b.location.reload(),c?h=this.o(j.getHours(),j.getMinutes()):h++,h>=this.end?(a.title="RL Schedule",f="After school",i=this.u(),this.P&&this.L[this.P].classList.remove("period-highlight"),m=!0):h<this.start?(f="Before school",d=this.T(this.start-h),i=this.U(d.V,"hour"," ","")+this.U(d.W,"minute"," ")+"until homeroom."):(-4===this.S||void 0===this.S?(this.R(c),f=this.O(0)):this.S--,this.S<=0?(i="Passing time: "+this.U(this.S+5,"minute")+" until "+this.O(1),0===this.S&&(a.title="RL Schedule",e("RL Schedule",this.O(1)+" starts in 5 minutes."))):(i=this.U(this.S,"minute")+" left",a.title="("+this.S+") RL Schedule"),5===this.S&&e("RL Schedule","5 minutes left in "+this.O(0))),f&&(l.id("current-title").textContent=f),i&&(l.id("current-description").textContent=i),m||setTimeout(this.update.bind(this),6e4-1e3*j.getSeconds())},t:function(){if(this.q){var a="HGFEDCBA";return a[(a.indexOf(this.q)+1+this.N())%8]}return b.localStorage.getItem("next-day")||0},u:function(){var a=this.t();return a?(g>0&&g<5?"Tomorrow":"The next school day")+" starts with "+a+" block.":""},o:function(a,b){if("string"==typeof a){var c=a.split(":");return 60*c[0]+1*c[1]}if("number"==typeof a)return 60*a+1*b},T:function(a){return{V:Math.floor(a/60),W:a%60}},I:function(a){var b=this.T(a);return b.W<10&&(b.W="0"+b.W),(b.V%12||12)+":"+b.W},U:function(a,b,c,d){return 0===a?d||"":1===a?a+" "+b+(c||""):a+" "+b+"s"+(c||"")},M:["First Lunch","In Between Lunches","Second Lunch"]};d("rlclock.tk"===b.location.hostname?"//casper.roxburylatin.org/todays_schedule.json":"todays_schedule.json",function(){m.h(JSON.parse(this.responseText))},m.error),addEventListener("DOMContentLoaded",function c(){removeEventListener("DOMContentLoaded",c),m.m(),o.load(),l.id("settings-button").addEventListener("click",o.toggle.bind(o)),l.id("about-toggle").addEventListener("click",function(a){return a.preventDefault(),l.id("about-more").textContent?l.id("about-more").classList.toggle("hide"):d("about.txt",function(){l.id("about-more").textContent=this.responseText}),!1}),((j.getHours()>=19||j.getHours()<=6)&&"false"!==b.localStorage.getItem("dark")||"true"===b.localStorage.getItem("dark"))&&(a.querySelector(".dark").checked=!0),a.querySelector(".dark").addEventListener("click",function(a){b.localStorage.setItem("dark",a.target.checked)})});var n,o={data:{g:!1},load:function(){this.data=JSON.parse(b.localStorage.getItem("settings"))||this.data},X:function(){var a;this.Y=l.id("settings").getElementsByTagName("input");for(var b=0;b<this.Y.length;b++)a=this.Y[b],a.checked=this.data[a.getAttribute("data-rep")];l.id("settings-submit").addEventListener("click",this.submit.bind(this)),this.Z=!0},save:function(){for(var a,c=0;c<this.Y.length;c++)a=this.Y[c],this.data[a.getAttribute("data-rep")]=a.checked;b.localStorage.setItem("settings",JSON.stringify(this.data)),this.data.g&&f()},submit:function(){this.save(),this.toggle()},toggle:function(){this.Z||this.X(),l.id("settings").classList.toggle("appear")}}}(document,window);