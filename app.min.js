"use strict";Date.now||(Date.now=function(){return(new Date).getTime()}),640<screen.width&&document.documentElement.classList.add("hoverable"),addEventListener("ontouchstart",function t(){document.documentElement.classList.remove("hoverable"),removeEventListener("ontouchstart",t)}),function(r,n){var o,t=2,a=new Date,d=a.getDay(),h=0,l="RL Schedule";function e(t){return t[t.length-1]}var u={id:function(t){return this.elements[t]||(this.elements[t]=r.getElementById(t))},elements:{}},i={loadSchedule:function(t){if(this.isSchool=!!t.periods,!this.isSchool)return this.noSchool();this.setupDay(t),this.prepareScheduleDOM(),this.checkReady()},setupDay:function(t){this.periods=t.periods,this.hallLength=t.hallLength,"Hall"===this.periods[1].name&&(this.hallLength=this.fullMinutes(this.periods[1].end)-this.fullMinutes(this.periods[1].start)),this.firstPeriod=1,this.hallLength&&"Hall"===this.periods[1].name&&this.firstPeriod++,this.dayLetter=this.periods[this.firstPeriod].block,this.dayName=this.dayLetter,this.hallLength&&(this.dayName+="-"+this.hallLength),this.lunchPeriod=t.lunchPeriod||(45<=this.hallLength?3:4),5===d&&(n.localStorage.setItem("next-day",this.tomorrowDayType()),n.localStorage.setItem("next-day-rec",a.getDate()))},error:function(){t++,u.id("periods-list").textContent="Sorry, there has been an error. Please try reloading soon.",u.id("periods-list").classList.remove("hide")},noSchool:function(){var t;t=6===d||0===d?"Weekend":"No School",u.id("current-title").textContent=t,u.id("current-description").textContent=this.displayTomorrowDayType()},prepareScheduleDOM:function(){for(var t=r.createDocumentFragment(),e=this.periods.length,i=0,s=0;s<e;s++){var n=this.periods[s];n.startMinutes=this.fullMinutes(n.start),n.endMinutes=this.fullMinutes(n.end),n.period===this.lunchPeriod&&"Hall"!==n.name&&(n.lunch=i++),t.appendChild(this.createBlock(this.periodName(n),this.formatMinutesAsTime(n.startMinutes)+"-"+this.formatMinutesAsTime(n.endMinutes)))}this.updatePeriodsList(t,this.dayName)},createBlock:function(t,e){var i=r.createElement("div");i.className="list-item";var s=r.createElement("span");s.className="list-item-letter",s.textContent=t,i.appendChild(s);var n=r.createElement("span");return n.className="list-item-time",n.textContent=e,i.appendChild(n),i},updatePeriodsList:function(t,e){this.periodsListBlocks=t,u.id("periods-list-heading").textContent=e,u.id("periods-list-blocks").appendChild(this.periodsListBlocks),u.id("periods-list").classList.remove("hide"),this.periodsChildren=u.id("periods-list-blocks").childNodes},checkReady:function(){--t||(this.start=this.periods[0].startMinutes,this.end=e(this.periods).endMinutes,this.update(!0))},periodName:function(t){return t.period===this.lunchPeriod&&"Hall"!==t.name?t.block+" - "+this.lunches[t.lunch]:t.block||t.name},isDrop:function(){return 6===e(this.periods).period},getRelativePeriod:function(t){return this.periodName(this.periods[this.currentPeriod+t])},updatePeriod:function(){if(void 0===this.currentPeriod)for(var t=0;t<this.periods.length;t++){var e=this.periods[t];if(h>=e.startMinutes&&h<e.endMinutes+5){this.currentPeriod=t;break}}else this.periodsChildren[this.currentPeriod].classList.remove("period-highlight"),this.currentPeriod++;this.minutesLeft=this.periods[this.currentPeriod].endMinutes-h,this.periodsChildren[this.currentPeriod].classList.add("period-highlight")},update:function(){var t,e,i,s;a.setTime(Date.now()),(o=a.getDay())!==d&&n.location.reload(),(h=this.fullMinutes(a.getHours(),a.getMinutes()))>=this.end?(r.title=l,e="After school",i=this.displayTomorrowDayType(),this.currentPeriod&&this.periodsChildren[this.currentPeriod].classList.remove("period-highlight"),s=!0):h<this.start?(e="Before school",t=this.hoursMinutes(this.start-h),i=this.formatNumberUnit(t.hours,"hour"," ","")+this.formatNumberUnit(t.minutes,"minute"," ")+"until homeroom."):(-4===this.minutesLeft||void 0===this.minutesLeft?(this.updatePeriod(),e=this.getRelativePeriod(0)):this.minutesLeft--,this.minutesLeft<=0?(i="Passing time: "+this.formatNumberUnit(this.minutesLeft+5,"minute")+" until "+this.getRelativePeriod(1),0===this.minutesLeft&&f(r.title=l,this.getRelativePeriod(1)+" starts in 5 minutes.")):(i=this.formatNumberUnit(this.minutesLeft,"minute")+" left",r.title="("+this.minutesLeft+") "+l),5===this.minutesLeft&&f(l,"5 minutes left in "+this.getRelativePeriod(0))),e&&(u.id("current-title").textContent=e),i&&(u.id("current-description").textContent=i),s||setTimeout(this.update.bind(this),6e4-1e3*a.getSeconds())},tomorrowDayType:function(){if(this.dayLetter){var t="HGFEDCBA",e=t.indexOf(this.dayLetter)+1+this.isDrop();return t[e%8]}return Math.abs(a.getDate()-n.localStorage.getItem("next-day-rec"))<5?n.localStorage.getItem("next-day"):0},displayTomorrowDayType:function(){var t=this.tomorrowDayType();return t?(0<o&&o<5?"Tomorrow":"The next school day")+" starts with "+t+" block.":""},fullMinutes:function(t,e){if("number"==typeof t)return 60*t+1*e;if("string"==typeof t){var i=t.split(":");return 60*i[0]+1*i[1]}},hoursMinutes:function(t){return{hours:Math.floor(t/60),minutes:t%60}},formatMinutesAsTime:function(t){var e=this.hoursMinutes(t);return e.minutes<10&&(e.minutes="0"+e.minutes),(e.hours%12||12)+":"+e.minutes},formatNumberUnit:function(t,e,i,s){return 0===t?s||"":1===t?t+" "+e+(i||""):t+" "+e+"s"+(i||"")},lunches:["First Lunch","In Between Lunches","Second Lunch"]};function s(t,e,i){var s=new XMLHttpRequest;s.open("GET",t),s.addEventListener("load",e),s.addEventListener("error",i),s.send()}s("rlclock.ml"===n.location.hostname?"//casper.roxburylatin.org/todays_schedule.json":"todays_schedule.json",function(){i.loadSchedule(JSON.parse(this.responseText))},i.error),addEventListener("DOMContentLoaded",function t(){if(removeEventListener("DOMContentLoaded",t),i.checkReady(),m.load(),u.id("settings-button").addEventListener("click",m.toggle.bind(m)),u.id("about-toggle").addEventListener("click",function(t){return t.preventDefault(),u.id("about-more").textContent?u.id("about-more").classList.toggle("hide"):s("about.txt",function(){u.id("about-more").textContent=this.responseText}),!1}),!n.localStorage.getItem("domain")){var e=u.id("banner");e.classList.remove("fade"),e.addEventListener("click",function(){n.localStorage.setItem("domain",1),e.classList.add("fade")})}}),addEventListener("visibilitychange",function(){r.hidden||i.update()});var c,m={data:{notifications:!1},load:function(){this.data=JSON.parse(n.localStorage.getItem("settings"))||this.data,!1!==this.data.dark&&(this.data.dark||19<=a.getHours()||a.getHours()<=6)&&(u.id("dark").checked=!0,u.id("settings-form").querySelector('[data-rep="dark"]').checked=!0)},prepareDOM:function(){var t;this.allSettings=u.id("settings").getElementsByTagName("input");for(var e=0;e<this.allSettings.length;e++)(t=this.allSettings[e]).checked=this.data[t.getAttribute("data-rep")];u.id("settings-submit").addEventListener("click",this.submit.bind(this)),this.isDOMReady=!0},save:function(){for(var t,e=0;e<this.allSettings.length;e++)t=this.allSettings[e],this.data[t.getAttribute("data-rep")]=t.checked;n.localStorage.setItem("settings",JSON.stringify(this.data)),this.data.notifications&&function(){if(!n.Notification)return alert("Notifications not supported.");if("granted"===n.Notification.permission)return;n.Notification.requestPermission()}(),u.id("dark").checked=this.data.dark},submit:function(){this.save(),this.toggle()},toggle:function(){this.isDOMReady||this.prepareDOM(),u.id("settings").classList.toggle("appear")}};function f(t,e){"granted"===n.Notification.permission&&m.data.notifications&&(c&&setTimeout(c.close.bind(c),5e3),c=new n.Notification(e,{title:t}))}}(document,window);