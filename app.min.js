"use strict";Date.now||(Date.now=function(){return(new Date).getTime()}),function(){function a(a){return a[a.length-1]}function b(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.addEventListener("load",b),d.addEventListener("error",c),d.send()}function c(a,b){"granted"===window.Notification.permission&&n.data.g&&(m&&setTimeout(m.close.bind(m),5e3),m=new window.Notification(b,{title:a}))}function d(){return window.Notification?void("granted"!==window.Notification.permission&&window.Notification.requestPermission()):alert("Notifications not supported.")}var e,f,g=2,h=new Date,i=h.getDay(),j="RL Schedule",k={id:function(a){return this.elements[a]||(this.elements[a]=document.getElementById(a))},elements:{}},l={h:function(a){return this.i=!!a.periods,this.i?(this.j(a),this.k(),void this.l()):this.m()},j:function(a){this.periods=a.periods,this.hallLength=a.hallLength,"Hall"===this.periods[1].name&&(this.hallLength=this.o(this.periods[1].end)-this.o(this.periods[1].start)),this.p=1,this.hallLength&&"Hall"===this.periods[1].name&&this.p++,this.q=this.periods[this.p].block,this.s=this.q,this.hallLength&&(this.s+="-"+this.hallLength),this.lunchPeriod=a.lunchPeriod||(this.hallLength>=45?3:4)},error:function(){g++,k.id("periods-list").textContent="Sorry, there has been an error. Please try reloading soon.",k.id("periods-list").style.display="block"},m:function(){var a;a=6===i||0===i?"Weekend":"No School",k.id("current-title").textContent=a},k:function(){for(var a=document.createDocumentFragment(),b=this.periods.length,c=0,d=0;d<b;d++){var e=this.periods[d];e.t=this.o(e.start),e.u=this.o(e.end),e.period===this.lunchPeriod&&(e.v=c++);var f=document.createElement("div");f.className="list-item";var g=document.createElement("span");g.className="list-item-letter",g.textContent=this.A(e),f.appendChild(g);var h=document.createElement("span");h.className="list-item-time",h.textContent=this.B(e.t)+"-"+this.B(e.u),f.appendChild(h),a.appendChild(f)}this.C=a,k.id("periods-list-heading").textContent=this.s,k.id("periods-list-blocks").appendChild(this.C),k.id("periods-list").style.display="block",k.id("about").style.display="block",this.D=k.id("periods-list-blocks").childNodes},l:function(){--g||(this.start=this.periods[0].t,this.end=a(this.periods).u,this.update(!0))},A:function(a){return a.period===this.lunchPeriod?a.block+" - "+this.F[a.v]:a.block||a.name},G:function(){return 6===a(this.periods).period},H:function(a){return this.A(this.periods[this.I+a])},J:function(){if(void 0===this.I)for(var a=0;a<this.periods.length;a++){var b=this.periods[a];if(f>=b.t&&f<b.u+5){this.I=a;break}}else this.D[this.I].classList.remove("period-highlight"),this.I++;this.K=this.periods[this.I].u-f,this.D[this.I].classList.add("period-highlight")},update:function(a){var b,d,g,l;h.setTime(Date.now()),e=h.getDay(),e!==i&&window.location.reload(),a?f=this.o(h.getHours(),h.getMinutes()):f++,f>=this.end?(document.title=j,d="After school",g=5!==e?"Tomorrow starts with "+this.L()+" block.":"The next school day starts with "+this.L()+" block.",this.I&&this.D[this.I].classList.remove("period-highlight"),l=!0):f<this.start?(d="Before school",b=this.M(this.start-f),g=this.N(b.O,"hour"," ","")+this.N(b.P,"minute"," ")+"until homeroom."):(this.K===-4||void 0===this.K?(this.J(a),d=this.H(0)):this.K--,this.K<=0?(g="Passing time: "+this.N(this.K+5,"minute")+" until "+this.H(1),0===this.K&&(document.title=j,c(j,this.H(1)+" starts in 5 minutes."))):(g=this.N(this.K,"minute")+" left",document.title=j+" ("+this.K+")"),5===this.K&&c(j,"5 minutes left in "+this.H(0))),d&&(k.id("current-title").textContent=d),g&&(k.id("current-description").textContent=g),l||setTimeout(this.update.bind(this),6e4-1e3*h.getSeconds())},L:function(){var a="HGFEDCBA",b=a.indexOf(this.q)+1+this.G();return a[b%8]},o:function(a,b){if("string"==typeof a){var c=a.split(":");return 60*c[0]+1*c[1]}if("number"==typeof a)return 60*a+1*b},M:function(a){return{O:Math.floor(a/60),P:a%60}},B:function(a){var b=this.M(a);return b.P<10&&(b.P="0"+b.P),(b.O%12||12)+":"+b.P},N:function(a,b,c,d){return 0===a?d||"":1===a?a+" "+b+(c||""):a+" "+b+"s"+(c||"")},F:["First Lunch","In Between Lunches","Second Lunch"]};b("//casper.roxburylatin.org/todays_schedule.json",function(){l.h(JSON.parse(this.responseText))},l.error),addEventListener("DOMContentLoaded",function o(){removeEventListener("DOMContentLoaded",o),l.l(),n.load(),k.id("settings-button").addEventListener("click",n.toggle.bind(n))});var m,n={data:{g:!1},load:function(){this.data=JSON.parse(localStorage.getItem("settings"))||this.data},R:function(){var a;this.S=k.id("settings").getElementsByTagName("input");for(var b=0;b<this.S.length;b++)a=this.S[b],a.checked=this.data[a.getAttribute("data-rep")];k.id("settings-submit").addEventListener("click",this.submit.bind(this)),this.T=!0},save:function(){for(var a,b=0;b<this.S.length;b++)a=this.S[b],this.data[a.getAttribute("data-rep")]=a.checked;localStorage.setItem("settings",JSON.stringify(this.data)),this.data.g&&d()},submit:function(){this.save(),this.toggle()},toggle:function(){this.T||this.R(),k.id("settings").classList.toggle("appear")}}}();
