"use strict";function arrayLastElement(a){return a[a.length-1]}Date.now||(Date.now=function(){return(new Date).getTime()}),function(){function a(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.addEventListener("load",b),d.addEventListener("error",c),d.send()}function b(a,b){"granted"===window.Notification.permission&&m.data.g&&(l&&setTimeout(l.close.bind(l),5e3),l=new window.Notification(b,{title:a}))}function c(){return window.Notification?void("granted"!==window.Notification.permission&&window.Notification.requestPermission()):alert("Notifications not supported.")}var d,e,f=2,g=new Date,h=g.getDay(),i="RL Schedule",j={id:function(a){return this.elements[a]||(this.elements[a]=document.getElementById(a))},elements:{}},k={h:function(a){return this.i=void 0!==a.j,this.i?(this.k(a),this.l(),void this.m()):this.o()},k:function(a){this.j=a.j,this.p=a.p,"Hall"===this.j[1].name&&(this.p=this.q(this.j[1].end)-this.q(this.j[1].start)),this.s=1,this.p&&"Hall"===this.j[1].name&&this.s++,this.t=this.j[this.s].u,this.v=this.t,this.p&&(this.v+="-"+this.p),this.A=a.A||(this.p>=45?3:4)},error:function(){f++,j.id("periods-list").textContent="Sorry, there has been an error. Please try reloading soon.",j.id("periods-list").style.display="block"},o:function(){var a;a=6===h||0===h?"Weekend":"No School",j.id("current-title").textContent=a},l:function(){for(var a=document.createDocumentFragment(),b=this.j.length,c=0,d=0;d<b;d++){var e=this.j[d];e.B=this.q(e.start),e.C=this.q(e.end),e.period===this.A&&(e.D=c++);var f=document.createElement("div");f.className="list-item";var g=document.createElement("span");g.className="list-item-letter",g.textContent=this.F(e),f.appendChild(g);var h=document.createElement("span");h.className="list-item-time",h.textContent=this.G(e.B)+"-"+this.G(e.C),f.appendChild(h),a.appendChild(f)}this.H=a,j.id("periods-list-heading").textContent=this.v,j.id("periods-list-blocks").appendChild(this.H),j.id("periods-list").style.display="block",j.id("about").style.display="block",this.I=j.id("periods-list-blocks").childNodes},m:function(){--f||(this.start=this.j[0].B,this.end=arrayLastElement(this.j).C,this.update(!0))},F:function(a){return a.period===this.A?a.u+" - "+this.J[a.D]:a.u||a.name},K:function(){return 6===arrayLastElement(this.j).period},L:function(a){return this.F(this.j[this.M+a])},N:function(){if(void 0===this.M)for(var a=0;a<this.j.length;a++){var b=this.j[a];if(e>=b.B&&e<b.C+5){this.M=a;break}}else this.I[this.M].classList.remove("period-highlight"),this.M++;this.O=this.j[this.M].C-e,this.I[this.M].classList.add("period-highlight")},update:function(a){var c,f,k,l;g.setTime(Date.now()),d=g.getDay(),d!==h&&window.location.reload(),a?e=this.q(g.getHours(),g.getMinutes()):e++,e>=this.end?(document.title=i,f="After school",k=5!==d?"Tomorrow starts with "+this.P()+" block.":"The next school day starts with "+this.P()+" block.",this.M&&this.I[this.M].classList.remove("period-highlight"),l=!0):e<this.start?(f="Before school",c=this.R(this.start-e),k=this.S(c.T,"hour"," ","")+this.S(c.U,"minute"," ")+"until homeroom."):(this.O===-4||void 0===this.O?(this.N(a),f=this.L(0)):this.O--,this.O<=0?(k="Passing time: "+this.S(this.O+5,"minute")+" until "+this.L(1),0===this.O&&(document.title=i,b(i,this.L(1)+" starts in 5 minutes."))):(k=this.S(this.O,"minute")+" left",document.title=i+" ("+this.O+")"),5===this.O&&b(i,"5 minutes left in "+this.L(0))),f&&(j.id("current-title").textContent=f),k&&(j.id("current-description").textContent=k),l||setTimeout(this.update.bind(this),6e4-1e3*g.getSeconds())},P:function(){var a="HGFEDCBA",b=a.indexOf(this.t)+1+this.K();return a[b%8]},q:function(a,b){if("string"==typeof a){var c=a.split(":");return 60*c[0]+1*c[1]}if("number"==typeof a)return 60*a+1*b},R:function(a){return{T:Math.floor(a/60),U:a%60}},G:function(a){var b=this.R(a);return b.U<10&&(b.U="0"+b.U),(b.T%12||12)+":"+b.U},S:function(a,b,c,d){return 0===a?d||"":1===a?a+" "+b+(c||""):a+" "+b+"s"+(c||"")},J:["First Lunch","In Between Lunches","Second Lunch"]};a("//casper.roxburylatin.org/todays_schedule.json",function(){k.h(JSON.parse(this.responseText))},k.error),addEventListener("DOMContentLoaded",function n(){removeEventListener("DOMContentLoaded",n),k.m(),m.load(),j.id("settings-button").addEventListener("click",m.toggle.bind(m))});var l,m={data:{g:!1},load:function(){this.data=JSON.parse(localStorage.getItem("settings"))||this.data},V:function(){var a;this.W=j.id("settings").getElementsByTagName("input");for(var b=0;b<this.W.length;b++)a=this.W[b],a.checked=this.data[a.getAttribute("data-rep")];j.id("settings-submit").addEventListener("click",this.submit.bind(this)),this.X=!0},save:function(){for(var a,b=0;b<this.W.length;b++)a=this.W[b],this.data[a.getAttribute("data-rep")]=a.checked;localStorage.setItem("settings",JSON.stringify(this.data)),this.data.g&&c()},submit:function(){this.save(),this.toggle()},toggle:function(){this.X||this.V(),j.id("settings").classList.toggle("appear")}}}();
