"use strict";Date.now||(Date.now=function(){return(new Date).getTime()}),640<screen.width&&document.documentElement.classList.add("hoverable"),addEventListener("ontouchstart",function t(){document.documentElement.classList.remove("hoverable"),removeEventListener("ontouchstart",t)}),function(h,n){var r,o,t=2,u=new Date,a=u.getDay(),c=0,d="rlclock";function i(t){return t[t.length-1]}var l={id:function(t){return this.elements[t]||(this.elements[t]=h.getElementById(t))},elements:{}},s={t:function(t){if(this.i=!!t.periods,!this.i)return this.s();this.h(t),this.o(),this.u()},h:function(t){this.periods=t.periods,this.hallLength=t.hallLength,"Hall"===this.periods[1].name&&(this.hallLength=this.l(this.periods[1].end)-this.l(this.periods[1].start)),this.m=1,this.hallLength&&"Hall"===this.periods[1].name&&this.m++,this.p=this.periods[this.m].block,this.v=this.p,this.hallLength&&(this.v+="-"+this.hallLength),this.lunchPeriod=t.lunchPeriod||(45<=this.hallLength?3:4),5===a&&(n.localStorage.setItem("next-day",this.g()),n.localStorage.setItem("next-day-rec",u.getDate()))},error:function(){t++,l.id("periods-list").textContent="Sorry, there has been an error. Please try reloading soon.",l.id("periods-list").classList.remove("hide")},s:function(){var t;t=6===a||0===a?"Weekend":"No School",l.id("current-title").textContent=t,l.id("current-description").textContent=this.k()},o:function(){for(var t=h.createDocumentFragment(),i=this.periods.length,s=0,e=0;e<i;e++){var n=this.periods[e];n.D=this.l(n.start),n.L=this.l(n.end),n.period===this.lunchPeriod&&"Hall"!==n.name&&(n.M=s++),t.appendChild(this.S(this.T(n),this.N(n.D)+"-"+this.N(n.L)))}this.O(t,this.v)},S:function(t,i){var s=h.createElement("div");s.className="list-item";var e=h.createElement("span");e.className="list-item-letter",e.textContent=t,s.appendChild(e);var n=h.createElement("span");return n.className="list-item-time",n.textContent=i,s.appendChild(n),s},O:function(t,i){this.H=t,l.id("periods-list-heading").textContent=i,l.id("periods-list-blocks").appendChild(this.H),l.id("periods-list").classList.remove("hide"),this.P=l.id("periods-list-blocks").childNodes},u:function(){--t||(this.start=this.periods[0].D,this.end=i(this.periods).L,this.update(!0))},T:function(t){return t.period===this.lunchPeriod&&"Hall"!==t.name?t.block+" - "+this.B[t.M]:t.block||t.name},A:function(){return 6===i(this.periods).period},C:function(t){return this.T(this.periods[this.J+t])},R:function(){if(void 0===this.J)for(var t=0;t<this.periods.length;t++){var i=this.periods[t];if(c>=i.D&&c<i.L+5){this.J=t;break}}else this.P[this.J].classList.remove("period-highlight"),this.J++;this.P[this.J].classList.add("period-highlight")},update:function(){var t,i,s,e;u.setTime(Date.now()),(r=u.getDay())!==a&&n.location.reload(),(c=this.l(u.getHours(),u.getMinutes()))!==o&&((o=c)>=this.end?(h.title=d,i="After school",s=this.k(),this.J&&this.P[this.J].classList.remove("period-highlight"),e=!0):c<this.start?(i="Before school",t=this.j(this.start-c),s=this.F(t.G,"hour"," ","")+this.F(t._,"minute"," ")+"until homeroom."):(void 0===this.q&&(this.R(),i=this.C(0)),this.q=this.periods[this.J].L-c,-5===this.q&&(this.R(),i=this.C(0)),this.q<=0?(s="Passing time: "+this.F(this.q+5,"minute")+" until "+this.C(1),0===this.q&&p(h.title=d,this.C(1)+" starts in 5 minutes.")):(s=this.F(this.q,"minute")+" left",h.title="("+this.q+") "+d),5===this.q&&p(d,"5 minutes left in "+this.C(0))),i&&(l.id("current-title").textContent=i),s&&(l.id("current-description").textContent=s),e||setTimeout(this.update.bind(this),6e4-1e3*u.getSeconds()))},g:function(){if(this.p){var t="HGFEDCBA",i=t.indexOf(this.p)+1+this.A();return t[i%8]}return Math.abs(u.getDate()-n.localStorage.getItem("next-day-rec"))<5?n.localStorage.getItem("next-day"):0},k:function(){var t=this.g();return t?(0<r&&r<5?"Tomorrow":"The next school day")+" starts with "+t+" block.":""},l:function(t,i){if("number"==typeof t)return 60*t+1*i;if("string"==typeof t){var s=t.split(":");return 60*s[0]+1*s[1]}},j:function(t){return{G:Math.floor(t/60),_:t%60}},N:function(t){var i=this.j(t);return i._<10&&(i._="0"+i._),(i.G%12||12)+":"+i._},F:function(t,i,s,e){return 0===t?e||"":1===t?t+" "+i+(s||""):t+" "+i+"s"+(s||"")},B:["First Lunch","In Between Lunches","Second Lunch"]};function e(t,i,s){var e=new XMLHttpRequest;e.open("GET",t),e.addEventListener("load",i),e.addEventListener("error",s),e.send()}e("rlclock.ml"===n.location.hostname?"//casper.roxburylatin.org/todays_schedule.json":"todays_schedule.json",function(){s.t(JSON.parse(this.responseText))},s.error),addEventListener("DOMContentLoaded",function t(){if(removeEventListener("DOMContentLoaded",t),s.u(),m.load(),l.id("settings-button").addEventListener("click",m.toggle.bind(m)),l.id("about-toggle").addEventListener("click",function(t){return t.preventDefault(),l.id("about-more").textContent?l.id("about-more").classList.toggle("hide"):e("about.txt",function(){l.id("about-more").textContent=this.responseText}),!1}),!n.localStorage.getItem("domain")){var i=l.id("banner");i.classList.remove("fade"),i.addEventListener("click",function(){n.localStorage.setItem("domain",1),i.classList.add("fade")})}}),addEventListener("visibilitychange",function(){0!==t||h.hidden||s.update()});var f,m={data:{I:!1},load:function(){this.data=JSON.parse(n.localStorage.getItem("settings"))||this.data,!1!==this.data.U&&(this.data.U||19<=u.getHours()||u.getHours()<=6)&&(l.id("dark").checked=!0,l.id("settings-form").querySelector('[data-rep="dark"]').checked=!0)},W:function(){var t;this.X=l.id("settings").getElementsByTagName("input");for(var i=0;i<this.X.length;i++)(t=this.X[i]).checked=this.data[t.getAttribute("data-rep")];l.id("settings-submit").addEventListener("click",this.submit.bind(this)),this.K=!0},save:function(){for(var t,i=0;i<this.X.length;i++)t=this.X[i],this.data[t.getAttribute("data-rep")]=t.checked;n.localStorage.setItem("settings",JSON.stringify(this.data)),this.data.I&&function(){if(!n.Notification)return alert("Notifications not supported.");if("granted"===n.Notification.permission)return;n.Notification.requestPermission()}(),l.id("dark").checked=this.data.U},submit:function(){this.save(),this.toggle()},toggle:function(){this.K||this.W(),l.id("settings").classList.toggle("appear")}};function p(t,i){"granted"===n.Notification.permission&&m.data.I&&(f&&setTimeout(f.close.bind(f),5e3),f=new n.Notification(i,{title:t}))}}(document,window);