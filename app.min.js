"use strict";Date.now||(Date.now=function(){return(new Date).getTime()}),screen.width>640&&document.documentElement.classList.add("hoverable"),addEventListener("ontouchstart",function t(){document.documentElement.classList.remove("hoverable"),removeEventListener("ontouchstart",t)}),function(t,e){var i,s,n=2,r=new Date,o=r.getDay(),a=0;function d(t){return t[t.length-1]}var h={id:function(e){return this.elements[e]||(this.elements[e]=t.getElementById(e))},elements:{}},l={loadSchedule:function(t){if(this.isSchool=!!t.periods,!this.isSchool)return this.noSchool();this.setupDay(t),this.prepareScheduleDOM(),this.checkReady()},setupDay:function(t){this.periods=t.periods,this.hallLength=t.hallLength,"Hall"===this.periods[1].name&&(this.hallLength=this.fullMinutes(this.periods[1].end)-this.fullMinutes(this.periods[1].start)),this.firstPeriod=1,this.hallLength&&"Hall"===this.periods[1].name&&this.firstPeriod++,this.dayLetter=this.periods[this.firstPeriod].block,this.dayName=this.dayLetter,this.hallLength&&(this.dayName+="-"+this.hallLength),this.lunchPeriod=t.lunchPeriod||(this.hallLength>=45?3:4),5===o&&(e.localStorage.setItem("next-day",this.tomorrowDayType()),e.localStorage.setItem("next-day-rec",r.getDate()))},error:function(){n++,h.id("periods-list").textContent="Sorry, there has been an error. Please try reloading soon.",h.id("periods-list").classList.remove("hide")},noSchool:function(){var t;t=6===o||0===o?"Weekend":"No School",h.id("current-title").textContent=t,h.id("current-description").textContent=this.displayTomorrowDayType()},prepareScheduleDOM:function(){for(var e=t.createDocumentFragment(),i=this.periods.length,s=0,n=0;n<i;n++){var r=this.periods[n];r.startMinutes=this.fullMinutes(r.start),r.endMinutes=this.fullMinutes(r.end),r.period===this.lunchPeriod&&"Hall"!==r.name&&(r.lunch=s++),e.appendChild(this.createBlock(this.periodName(r),this.formatMinutesAsTime(r.startMinutes)+"-"+this.formatMinutesAsTime(r.endMinutes)))}this.updatePeriodsList(e,this.dayName)},createBlock:function(e,i){var s=t.createElement("div");s.className="list-item";var n=t.createElement("span");n.className="list-item-letter",n.textContent=e,s.appendChild(n);var r=t.createElement("span");return r.className="list-item-time",r.textContent=i,s.appendChild(r),s},updatePeriodsList:function(t,e){this.periodsListBlocks=t,h.id("periods-list-heading").textContent=e,h.id("periods-list-blocks").appendChild(this.periodsListBlocks),h.id("periods-list").classList.remove("hide"),this.periodsChildren=h.id("periods-list-blocks").childNodes},checkReady:function(){--n||(this.start=this.periods[0].startMinutes,this.end=d(this.periods).endMinutes,this.update(!0))},periodName:function(t){return t.period===this.lunchPeriod&&"Hall"!==t.name?t.block+" - "+this.lunches[t.lunch]:t.block||t.name},isDrop:function(){return 6===d(this.periods).period},getRelativePeriod:function(t){return this.periodName(this.periods[this.currentPeriod+t])},updatePeriod:function(){if(void 0===this.currentPeriod)for(var t=0;t<this.periods.length;t++){var e=this.periods[t];if(a>=e.startMinutes&&a<e.endMinutes+5){this.currentPeriod=t;break}}else this.periodsChildren[this.currentPeriod].classList.remove("period-highlight"),this.currentPeriod++;this.periodsChildren[this.currentPeriod].classList.add("period-highlight")},update:function(){var n,d,l,u;r.setTime(Date.now()),(i=r.getDay())!==o&&e.location.reload(),(a=this.fullMinutes(r.getHours(),r.getMinutes()))!==s&&(s=a,a>=this.end?(t.title="rlclock",d="After school",l=this.displayTomorrowDayType(),this.currentPeriod&&this.periodsChildren[this.currentPeriod].classList.remove("period-highlight"),u=!0):a<this.start?(d="Before school",n=this.hoursMinutes(this.start-a),l=this.formatNumberUnit(n.hours,"hour"," ","")+this.formatNumberUnit(n.minutes,"minute"," ")+"until homeroom."):(void 0===this.minutesLeft&&(this.updatePeriod(),d=this.getRelativePeriod(0)),this.minutesLeft=this.periods[this.currentPeriod].endMinutes-a,this.minutesLeft<=-5&&(this.updatePeriod(),d=this.getRelativePeriod(0)),this.minutesLeft<=0?(l="Passing time: "+this.formatNumberUnit(this.minutesLeft+5,"minute")+" until "+this.getRelativePeriod(1),0===this.minutesLeft&&(t.title="rlclock",p("rlclock",this.getRelativePeriod(1)+" starts in 5 minutes."))):(l=this.formatNumberUnit(this.minutesLeft,"minute")+" left",t.title="("+this.minutesLeft+") rlclock"),5===this.minutesLeft&&p("rlclock","5 minutes left in "+this.getRelativePeriod(0))),d&&(h.id("current-title").textContent=d),l&&(h.id("current-description").textContent=l),u||setTimeout(this.update.bind(this),6e4-1e3*r.getSeconds()))},tomorrowDayType:function(){if(this.dayLetter){return"HGFEDCBA"[("HGFEDCBA".indexOf(this.dayLetter)+1+this.isDrop())%8]}return Math.abs(r.getDate()-e.localStorage.getItem("next-day-rec"))<5?e.localStorage.getItem("next-day"):0},displayTomorrowDayType:function(){var t=this.tomorrowDayType();return t?(i>0&&i<5?"Tomorrow":"The next school day")+" starts with "+t+" block.":""},fullMinutes:function(t,e){if("number"==typeof t)return 60*t+1*e;if("string"==typeof t){var i=t.split(":");return 60*i[0]+1*i[1]}},hoursMinutes:function(t){return{hours:Math.floor(t/60),minutes:t%60}},formatMinutesAsTime:function(t){var e=this.hoursMinutes(t);return e.minutes<10&&(e.minutes="0"+e.minutes),(e.hours%12||12)+":"+e.minutes},formatNumberUnit:function(t,e,i,s){return 0===t?s||"":1===t?t+" "+e+(i||""):t+" "+e+"s"+(i||"")},lunches:["First Lunch","In Between Lunches","Second Lunch"]};function u(t,e,i){var s=new XMLHttpRequest;s.open("GET",t),s.addEventListener("load",e),s.addEventListener("error",i),s.send()}u("//casper.roxburylatin.org/todays_schedule.json",function(){l.loadSchedule(JSON.parse(this.responseText))},l.error),addEventListener("DOMContentLoaded",function t(){removeEventListener("DOMContentLoaded",t),l.checkReady(),m.load(),h.id("settings-button").addEventListener("click",m.toggle.bind(m)),h.id("about-toggle").addEventListener("click",function(t){return t.preventDefault(),h.id("about-more").textContent?h.id("about-more").classList.toggle("hide"):u("about.txt",function(){h.id("about-more").textContent=this.responseText}),!1})}),void 0!==typeof t.hidden?addEventListener("visibilitychange",function(){0!==n||t.hidden||l.update()}):addEventListener("focus",function(){0===n&&l.update()});var c,m={data:{notifications:!1},load:function(){this.data=JSON.parse(e.localStorage.getItem("settings"))||this.data,!1!==this.data.dark&&(this.data.dark||r.getHours()>=19||r.getHours()<=6)&&(h.id("dark").checked=!0,h.id("settings-form").querySelector('[data-rep="dark"]').checked=!0)},prepareDOM:function(){var t;this.allSettings=h.id("settings").getElementsByTagName("input");for(var e=0;e<this.allSettings.length;e++)(t=this.allSettings[e]).checked=this.data[t.getAttribute("data-rep")];h.id("settings-submit").addEventListener("click",this.submit.bind(this)),this.isDOMReady=!0},save:function(){for(var t,i=0;i<this.allSettings.length;i++)t=this.allSettings[i],this.data[t.getAttribute("data-rep")]=t.checked;e.localStorage.setItem("settings",JSON.stringify(this.data)),this.data.notifications&&function(){if(!e.Notification)return alert("Notifications not supported.");if("granted"===e.Notification.permission)return;e.Notification.requestPermission()}(),h.id("dark").checked=this.data.dark},submit:function(){this.save(),this.toggle()},toggle:function(){this.isDOMReady||this.prepareDOM(),h.id("settings").classList.toggle("appear")}};function p(t,i){"granted"===e.Notification.permission&&m.data.notifications&&(c&&setTimeout(c.close.bind(c),5e3),c=new e.Notification(i,{title:t}))}}(document,window);
